
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-LXJ5Q7LKKE"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'G-LXJ5Q7LKKE');
        </script>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Player Rewards Leaders</title>
        
        <!-- Add resource hints -->
        <link rel="preconnect" href="https://cdnjs.cloudflare.com">
        <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
        <link rel="preconnect" href="https://www.googletagmanager.com">
        <link rel="dns-prefetch" href="https://www.googletagmanager.com">
        
        <link rel="icon" type="image/png" href="icons/favicon.webp">
        <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" as="style">
        <link rel="stylesheet" href="./styles.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
        <style>
            .total-row {
                background-color: rgba(0, 0, 0, 0.1);
                font-weight: bold;
            }

            .total-row td {
                border-top: 2px solid #666;
            }
        </style>
    </head>
    <body>
        <div class="title-container">
            <h1 class="title-header">
                <a href="index.html" class="home-link">
                    <i class="fas fa-home"></i>
                </a>
                Player Rewards Leaders
                <span class="tournament-badge">Main 38</span>
            </h1>
        </div>
        <div id="search-container" style="display: flex; align-items: center; gap: 10px;">
            <button class="button-group button-group--pink" id="my-decks-group">
                <span class="button-label">My Decks</span>
                <i class="fa-regular fa-user"></i>
            </button>
            <div style="position: relative; display: flex; align-items: center; flex-grow: 1;">
                <input type="text" id="player_handle" class="search-box" placeholder="Search Player Handle">
                <span class="clear-search"></span>
            </div>
            
        <div class="filter-dropdown debug-dropdown">
            <button class="filter-button debug-button">
                <i class="fas fa-filter"></i>
                <span class="filter-label">Player Type</span>
            </button>
            <div class="filter-content debug-content">
    
            </div>
        </div>
    
        </div>
        <div class="small-text">
            <span id="timestamp">2025-02-06 16:38 UTC</span>
            <span id="timeAgo"></span>
            <span class="info-text"> | Click                         <svg class="chevron-icon" viewBox="0 0 448 512" width="12" height="12">
                            <path fill="#00d9fb" d="M224 416c-8.188 0-16.38-3.125-22.62-9.375l-192-192c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L224 338.8l169.4-169.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-192 192C240.4 412.9 232.2 416 224 416z"/>
                        </svg> to see reward history</span>
        </div>
        <div class="table-container">
        <table id="playersTable">
            <tr>
                <th style="text-align: left;"></th>
                <th class="player-column"></th>
                <th class="rank-columns itm-decks-column">
                    <span class="tooltip">
                        ITM Decks
                        <span class="top-text top">ITM = won at least 1 card</span>
                    </span>
                </th>
                <th class="reward-columns rewards-section" data-sort="reward_eth"><img src="icons/eth.webp" class="reward-icon"><div class="sort-arrows"><span class="sort-arrow up"></span><span class="sort-arrow down active"></span></div></th>
                <th class="reward-columns rewards-section" data-sort="combined_packs"><img src="icons/fragment.webp" class="reward-icon" style="padding-left: 2px;"><div class="sort-arrows"><span class="sort-arrow up"></span><span class="sort-arrow down"></span></div></th>
                <th class="reward-columns rewards-section" data-sort="reward_fan"><img src="icons/fan.webp" class="reward-icon"><div class="sort-arrows"><span class="sort-arrow up"></span><span class="sort-arrow down"></span></div></th>
                <th class="reward-columns rewards-section" data-sort="reward_gold"><img src="icons/blast.webp" class="reward-icon"><div class="sort-arrows"><span class="sort-arrow up"></span><span class="sort-arrow down"></span></div></th>
                <th class="rank-columns ranks-section" style="min-width: 37px;">
                    <span class="tooltip" style="color: white; cursor: default;">
                        <img src="icons/elite.webp" class="league-icon" alt="Elite">
                        <span class="top">Best rank achieved</span>
                    </span>
                </th>
                <th class="rank-columns ranks-section" style="min-width: 37px;">
                    <span class="tooltip" style="color: white; cursor: default;">
                        <img src="icons/gold.webp" class="league-icon" alt="Gold">
                        <span class="top">Best rank achieved</span>
                    </span>
                </th>
                <th class="rank-columns ranks-section" style="min-width: 37px;">
                    <span class="tooltip" style="color: white; cursor: default;">
                        <img src="icons/silver.webp" class="league-icon" alt="Silver">
                        <span class="top">Best rank achieved</span>
                    </span>
                </th>
                <th class="rank-columns ranks-section" style="min-width: 37px;">
                    <span class="tooltip" style="color: white; cursor: default;">
                        <img src="icons/bronze.webp" class="league-icon" alt="Bronze">
                        <span class="top">Best rank achieved</span>
                    </span>
                </th>
                <th class="rank-columns ranks-section" style="min-width: 37px;">
                    <span class="tooltip" style="color: white; cursor: default;">
                        <img src="icons/reverse.webp" class="league-icon" alt="Reverse">
                        <span class="top">Best rank achieved</span>
                    </span>
                </th>
            </tr>
    
            </tbody>
            </table>
        </div>
    
        <div style="text-align: center; margin: 10px 0; font-size: 8px;">
            Total Records: <span id="recordCount" style="font-weight: bold; font-size: 16px;">0</span> (only players with 2+ cards won, heroes or nbc wallets included)
        </div>
        <div class="pagination-controls">
            <div class="pagination">
                <button class="page-link" id="prevPage" disabled>Previous</button>
                <div id="pageNumbers" class="page-numbers"></div>
                <button class="page-link" id="nextPage">Next</button>
            </div>
            <div class="items-per-page" style="margin-left: 10px;">
                Show <select id="itemsPerPage">
                    <option value="100">100</option>
                    <option value="50" selected>50</option>
                    <option value="25">25</option>
                    <option value="10">10</option>
                </select> records per page
            </div>
        </div>
        </div>
    
        <script>
            const jsonPath = 'player_tournament_history.json';

            // Add this function near the top of the script section, colors the rewards columns in details
            function getColorForValue(value, maxValue) {
                if (value === 0) return '';  // No color for zero values
                
                // Create a normalized value between 0 and 1
                const ratio = value / maxValue;
                
                // Define colors from RdYlGn colormap (red -> yellow -> green)
                const colors = [
                    [215, 48, 39],   // red
                    [244, 109, 67],  // red-orange
                    [253, 174, 97],  // light orange
                    [254, 224, 139], // pale yellow
                    [255, 255, 191], // yellow
                    [217, 239, 139], // light yellow-green
                    [166, 217, 106], // light green
                    [102, 189, 99],  // green
                    [26, 152, 80]    // dark green
                ];

                // Find the position in the color array
                const position = ratio * (colors.length - 1);
                const index = Math.floor(position);
                
                // If we're exactly on a color, return it
                if (index === position) {
                    const [r, g, b] = colors[index];
                    return `rgba(${r}, ${g}, ${b}, 0.7)`;
                }
                
                // Otherwise interpolate between two colors
                const [r1, g1, b1] = colors[index];
                const [r2, g2, b2] = colors[index + 1];
                const fraction = position - index;
                
                const r = Math.round(r1 + (r2 - r1) * fraction);
                const g = Math.round(g1 + (g2 - g1) * fraction);
                const b = Math.round(b1 + (b2 - b1) * fraction);
                
                return `rgba(${r}, ${g}, ${b}, 0.7)`;
            }


            async function toggleDetails(button) {
                const medalSvg = `<i class="fas fa-medal pr-medal" style="color: gold;"></i>`; 
                const row = button.closest('tr');
                const playerHandle = button.getAttribute('data-player');
                const isExpanded = button.getAttribute('aria-expanded') === 'true';
                
                // Remove existing detail rows for this player
                let next = row.nextElementSibling;
                while (next && next.classList.contains('details-row')) {
                    const toRemove = next;
                    next = next.nextElementSibling;
                    toRemove.remove();
                }
                
                const getPRIndicator = (currentRank, allRanks) => {
                    return currentRank === Math.min(...allRanks.filter(r => r !== null && r !== undefined)) ? medalSvg : '';
                };

                if (!isExpanded) {
                    try {
                        // Show loading indicator
                        button.classList.add('loading');
                        
                        // Fetch player history with cache-busting
                        const response = await fetch(`${jsonPath}?_=${Date.now()}`);
                        const data = await response.json();
                        const historyData = data.players;  // Access the players array from the response

                        const playerHistory = historyData
                            .filter(entry => entry.player_handle === playerHandle)
                            .sort((a, b) => b.tournament_seq_nbr - a.tournament_seq_nbr);  // Sort by sequence number descending

                        // Get all ranks for this player after we have the data
                        const allEliteRanks = playerHistory.map(h => h.elite_rank).filter(r => r !== null && r !== undefined);
                        const allGoldRanks = playerHistory.map(h => h.gold_rank).filter(r => r !== null && r !== undefined);
                        const allSilverRanks = playerHistory.map(h => h.silver_rank).filter(r => r !== null && r !== undefined);
                        const allBronzeRanks = playerHistory.map(h => h.bronze_rank).filter(r => r !== null && r !== undefined);
                        const allSubRanks = playerHistory.map(h => h.sub_rank).filter(r => r !== null && r !== undefined);

                        // Add these lines after getting playerHistory but before the for loop
                        const maxEth = Math.max(...playerHistory.map(h => h.reward_eth));
                        const maxPacks = Math.max(...playerHistory.map(h => h.reward_pack));
                        const maxFrag = Math.max(...playerHistory.map(h => h.reward_frag));
                        const maxFan = Math.max(...playerHistory.map(h => h.reward_fan));
                        const maxGold = Math.max(...playerHistory.map(h => h.reward_gold));

                        // Insert history rows
                        for (const history of playerHistory) {
                            const combinedPacks = history.reward_pack * 100 + history.reward_frag;  // Updated calculation
                            const detailRow = document.createElement('tr');
                            detailRow.className = 'details-row';
                            detailRow.innerHTML = `
                                <td></td>
                                <td>${history.tournament_unique_key}</td>
                                <td>${history.decks > 0 ? `${history.itm_decks} / ${history.decks} (${((history.itm_decks / history.decks) * 100).toFixed(0)}%)` : '-'}</td>
                                <td><span style="color: ${getColorForValue(history.reward_eth, maxEth)}">${history.reward_eth === 0 ? '-' : history.reward_eth.toFixed(3)}</span></td>
                                <td><span style="color: ${getColorForValue(combinedPacks, maxPacks * 100 + maxFrag)}">${combinedPacks === 0 ? '-' : Math.floor(combinedPacks)}</span></td>
                                <td><span style="color: ${getColorForValue(history.reward_fan, maxFan)}">${history.reward_fan === 0 ? '-' : formatRewardFan(history.reward_fan)}</span></td>
                                <td><span style="color: ${getColorForValue(history.reward_gold, maxGold)}">${history.reward_gold === 0 ? '-' : Math.floor(history.reward_gold)}</span></td>
                                <td class="rank-cell">${Number.isInteger(history.elite_rank) ? 
                                    `<span class="rank-value">${history.elite_rank}</span>${getPRIndicator(history.elite_rank, allEliteRanks)}` : 
                                    '-'}</td>
                                <td class="rank-cell">${Number.isInteger(history.gold_rank) ? 
                                    `<span class="rank-value">${history.gold_rank}</span>${getPRIndicator(history.gold_rank, allGoldRanks)}` : 
                                    '-'}</td>
                                <td class="rank-cell">${Number.isInteger(history.silver_rank) ? 
                                    `<span class="rank-value">${history.silver_rank}</span>${getPRIndicator(history.silver_rank, allSilverRanks)}` : 
                                    '-'}</td>
                                <td class="rank-cell">${Number.isInteger(history.bronze_rank) ? 
                                    `<span class="rank-value">${history.bronze_rank}</span>${getPRIndicator(history.bronze_rank, allBronzeRanks)}` : 
                                    '-'}</td>
                                <td class="rank-cell">${Number.isInteger(history.sub_rank) ? 
                                    `<span class="rank-value">${history.sub_rank}</span>${getPRIndicator(history.sub_rank, allSubRanks)}` : 
                                    '-'}</td>
                            `;
                            row.insertAdjacentElement('afterend', detailRow);
                        }

                        // Calculate totals
                        const totals = playerHistory.reduce((acc, history) => {
                            acc.eth += history.reward_eth || 0;
                            acc.combinedPacks += (history.reward_pack * 100 || 0) + (history.reward_frag || 0);
                            acc.fan += history.reward_fan || 0;
                            acc.gold += history.reward_gold || 0;
                            return acc;
                        }, { eth: 0, combinedPacks: 0, fan: 0, gold: 0 });

                        // Create and insert total row
                        const totalRow = document.createElement('tr');
                        totalRow.className = 'details-row total-row';
                        totalRow.innerHTML = `
                            <td></td>
                            <td><strong>Total</strong></td>
                            <td></td>
                            <td><strong>${totals.eth === 0 ? '-' : totals.eth.toFixed(3)}</strong></td>
                            <td><strong>${totals.combinedPacks === 0 ? '-' : Math.floor(totals.combinedPacks)}</strong></td>
                            <td><strong>${totals.fan === 0 ? '-' : formatRewardFan(totals.fan)}</strong></td>
                            <td><strong>${totals.gold === 0 ? '-' : Math.floor(totals.gold)}</strong></td>
                            <td colspan="5"></td>
                        `;
                        
                        // Insert after the last history row
                        row.parentNode.insertBefore(totalRow, next);
                    } catch (error) {
                        console.error('Error loading player history:', error);
                    } finally {
                        // Remove loading indicator
                        button.classList.remove('loading');
                    }
                }
                
                button.setAttribute('aria-expanded', !isExpanded);
            }

            // Sorting functionality improved 11.03.24 to handle pagination
            function sortTable(column, ascending) {
                var table = document.getElementById("playersTable");
                var rows = Array.from(table.rows).slice(1); // Convert to array and skip header
                
                // Filter out detail rows before sorting
                rows = rows.filter(row => !row.classList.contains('details-row'));
                
                var headerCells = table.rows[0].cells;
                var columnIndex = Array.from(headerCells).findIndex(cell => cell.getAttribute('data-sort') === column);
                
                if (columnIndex === -1) return;

                // Sort all rows, not just visible ones
                rows.sort((a, b) => {
                    let aCell = a.cells[columnIndex];
                    let bCell = b.cells[columnIndex];
                    
                    let aValue = parseFloat(aCell.getAttribute('data-value')) || 0;
                    let bValue = parseFloat(bCell.getAttribute('data-value')) || 0;

                    return ascending ? aValue - bValue : bValue - aValue;
                });

                // Clear the table body except for header
                while (table.rows.length > 1) {
                    table.deleteRow(1);
                }

                // Add all sorted rows back to the table
                rows.forEach(row => table.appendChild(row));

                // Reset to first page and update pagination
                window.currentPage = 1;
                updatePagination();
                updateRanks();
            }

            
            // Main update ranks function
            function updateRanks() {
                const rows = document.querySelectorAll('#playersTable tr');
                let rank = 1;
                
                rows.forEach(row => {
                    if (row.classList.contains('details-row')) return;
                    if (row.style.display === 'none') return;
                    if (row.querySelector('th')) return; // Skip header row
                    
                    const rankCell = row.querySelector('td.rank');
                    if (rankCell) {
                        rankCell.textContent = rank++;
                    }
                });
            }

            // Add helper function for fan rewards formatting
            function formatRewardFan(value) {
                if (value >= 1_000_000) {
                    return `${(value / 1_000_000).toFixed(0)}M`;
                } else if (value >= 1_000) {
                    return `${(value / 1_000).toFixed(0)}k`;
                }
                return value.toString();
            }
                
            // Main search functionality improved 11.03.24 with generic request
            function filterTable(searchText) {
                const table = document.getElementById('playersTable');
                const rows = table.getElementsByTagName('tr');
                const searchValue = searchText.toLowerCase().trim(); // Added trim()
                
                // Start from 1 to skip the header row
                for (let i = 1; i < rows.length; i++) {
                    const row = rows[i];
                    // Skip detail rows if they exist
                    if (row.classList.contains('details-row')) continue;
                    
                    const playerCell = row.querySelector('.player-link');
                    if (playerCell) {
                        const playerHandle = playerCell.textContent.toLowerCase();
                        const showRow = playerHandle.includes(searchValue);
                        row.style.display = showRow ? '' : 'none';
                        
                        // Hide/show any associated detail rows
                        let next = row.nextElementSibling;
                        while (next && next.classList.contains('details-row')) {
                            next.style.display = showRow ? '' : 'none';
                            next = next.nextElementSibling;
                        }
                    }
                }
            }

            // My Decks functionality
            function handleMyDecksClick() {
                const buttonGroup = document.querySelector('#my-decks-group');
                const icon = buttonGroup.querySelector('i');
                const selectedPlayerHandle = localStorage.getItem('selectedPlayerHandle');
                const searchBox = document.getElementById('player_handle');
                const clearButton = document.querySelector('.clear-search');
                const paginationControls = document.querySelector('.pagination-controls');
                const itemsPerPageContainer = document.querySelector('.items-per-page');

                // Clear all filter checkboxes and their button backgrounds
                const filterDropdowns = document.querySelectorAll('.filter-dropdown');
                filterDropdowns.forEach(dropdown => {
                    const checkboxes = dropdown.querySelectorAll('input[type="checkbox"]');
                    checkboxes.forEach(checkbox => {
                        checkbox.checked = false;
                    });
                    const filterButton = dropdown.querySelector('.filter-button');
                    filterButton.style.backgroundColor = '';
                });
                
                if (searchBox.value === selectedPlayerHandle) {
                    // Resetting My Decks
                    icon.className = 'fa-regular fa-user';
                    buttonGroup.classList.remove('selected');
                    searchBox.value = '';
                    searchBox.style.color = '';
                    searchBox.readOnly = false;
                    filterTable('');
                    updateRanks();
                    updateRecordCount();
                    window.currentPage = 1;
                    // Show pagination controls
                    if (paginationControls) paginationControls.style.display = 'flex';
                    if (itemsPerPageContainer) itemsPerPageContainer.style.display = 'block';
                } else {
                    // Enabling My Decks
                    icon.className = 'fa-solid fa-user';
                    buttonGroup.classList.add('selected');
                    searchBox.value = selectedPlayerHandle;
                    searchBox.style.color = '#F287DF';
                    searchBox.readOnly = true;
                    filterTable(selectedPlayerHandle);
                    updateRanks();
                    updateRecordCount();
                    // Hide pagination controls
                    if (paginationControls) paginationControls.style.display = 'none';
                    if (itemsPerPageContainer) itemsPerPageContainer.style.display = 'none';
                }
            }

            // Add this to ensure the script runs after DOM is loaded
            document.addEventListener('DOMContentLoaded', function() {

                // Setup filter options - consolidated event listeners
                const filterOptions = document.querySelectorAll('.filter-option input[type="checkbox"]');
                console.log('Found filter options:', filterOptions.length);
                
                if (filterOptions.length === 0) {
                    console.warn('No filter options found - check class names and HTML structure');
                } else {
                    filterOptions.forEach(checkbox => {
                        checkbox.addEventListener('change', function() {
                            // Update filter button background
                            const filterButton = this.closest('.filter-dropdown').querySelector('.filter-button');
                            filterButton.style.backgroundColor = this.checked ? '#80bdff' : '';
                            
                            // Apply filters and update ranks
                            applyFilters();
                            updateRanks();
                            updateRecordCount();
                        });
                    });
                }
                
                // Set default values
                window.currentPage = 1;
                const itemsPerPage = parseInt(document.getElementById('itemsPerPage').value) || 50;

                // Set initial data-filtered attribute for all rows
                const table = document.getElementById('playersTable');
                const allRows = Array.from(table.querySelectorAll('tr:not(:first-child)'));
                allRows.forEach(row => {
                    row.setAttribute('data-filtered', 'show');
                });

                // Initialize pagination display
                updatePaginationDisplay(allRows, window.currentPage, itemsPerPage);

                // Add event listener for items per page dropdown
                document.getElementById('itemsPerPage').addEventListener('change', function() {
                    const newItemsPerPage = parseInt(this.value);
                    window.currentPage = 1; // Reset to first page when changing items per page
                    updatePaginationDisplay(allRows, window.currentPage, newItemsPerPage);
                });
                
                // Setup My Decks button
                const selectedPlayerHandle = localStorage.getItem('selectedPlayerHandle');
                const myDecksGroup = document.getElementById('my-decks-group');

                if (selectedPlayerHandle) {
                    myDecksGroup.innerHTML = `
                        <span class="button-label">My Decks</span>
                        <i class="fa-regular fa-user"></i>
                    `;
                    // Add click event listener to the button
                    myDecksGroup.addEventListener('click', handleMyDecksClick);
                } else {
                    myDecksGroup.innerHTML = `
                        <span class="button-label">Add Player</span>
                        <a href="settings.html" style="text-decoration: none;">
                            <i class="fa-regular fa-user"></i>
                        </a>
                    `;
                }

                // Setup search functionality with clear button
                const searchBox = document.getElementById('player_handle');
                const clearButton = document.querySelector('.clear-search');

                searchBox.addEventListener('input', function(e) {
                    // Only show clear button if not in My Decks mode
                    const myDecksButton = document.getElementById('my-decks-group');
                    const isMyDecksMode = myDecksButton.classList.contains('selected');
                    
                    if (!isMyDecksMode) {
                        clearButton.style.display = e.target.value ? 'block' : 'none';
                    }

                    // Hide/show pagination based on search text
                    const paginationControls = document.querySelector('.pagination-controls');
                    const itemsPerPageContainer = document.querySelector('.items-per-page');
                    if (paginationControls) paginationControls.style.display = e.target.value ? 'none' : 'flex';
                    if (itemsPerPageContainer) itemsPerPageContainer.style.display = e.target.value ? 'none' : 'block';
                    
                    filterTable(e.target.value);
                    updateRecordCount();
                });

                // Setup clear button functionality
                clearButton.addEventListener('click', function() {
                    const myDecksButton = document.getElementById('my-decks-group');
                    const isMyDecksMode = myDecksButton.classList.contains('selected');
                    
                    // Only process clear if not in My Decks mode
                    if (!isMyDecksMode) {
                        searchBox.value = '';
                        filterTable('');
                        this.style.display = 'none';
                        searchBox.focus();
                    }
                });

                // Setup sorting
                const headers = document.querySelectorAll('th[data-sort]');
                headers.forEach(header => {
                    header.addEventListener('click', function() {
                        const column = this.getAttribute('data-sort');
                        const currentArrow = this.querySelector('.sort-arrow.active');
                        const isAscending = currentArrow ? currentArrow.classList.contains('up') : true;
                        
                        document.querySelectorAll('.sort-arrow').forEach(arrow => {
                            arrow.classList.remove('active');
                        });
                        
                        const newArrow = this.querySelector(isAscending ? '.sort-arrow.down' : '.sort-arrow.up');
                        if (newArrow) {
                            newArrow.classList.add('active');
                        }
                        
                        sortTable(column, !isAscending);
                    });
                });

                // Handle URL parameters
                const urlParams = new URLSearchParams(window.location.search);
                const playerParam = urlParams.get('player');
                if (playerParam) {
                    const searchBox = document.getElementById('player_handle');
                    searchBox.value = playerParam;
                    filterTable(playerParam);
                }       
                
                // Initialize filters
                initializeFilters();
                updateRecordCount();
            });

            function initializeFilters() {
                // Add click handlers to filter buttons
                document.querySelectorAll('.filter-button').forEach(button => {
                    button.addEventListener('click', function(event) {
                        event.stopPropagation();
                        const content = this.nextElementSibling;
                        content.style.display = content.style.display === 'block' ? 'none' : 'block';
                    });
                });

                // Add change handlers to checkboxes
                document.querySelectorAll('.filter-content input[type="checkbox"]').forEach(checkbox => {
                    checkbox.addEventListener('change', function() {
                        // Clear the search box
                        const searchBox = document.getElementById('player_handle');
                        if (searchBox) {
                            searchBox.value = '';
                            // Reset My Decks button if it's selected
                            const myDecksButton = document.getElementById('my-decks-group');
                            if (myDecksButton && myDecksButton.classList.contains('selected')) {
                                const icon = myDecksButton.querySelector('i');
                                icon.className = 'fa-regular fa-user';
                                myDecksButton.classList.remove('selected');
                                searchBox.style.color = '';
                                searchBox.readOnly = false;
                            }
                        }
                        applyFilters();
                        updateRecordCount();
                        updateRanks();
                    });
                });
            }

            function applyFilters() {
                const table = document.getElementById('playersTable');
                if (!table) {
                    console.error('Table not found!');
                    return;
                }

                // Get all data rows (excluding header)
                const allRows = Array.from(table.querySelectorAll('tr:not(:first-child)'));

                // Get selected filters
                const selectedPlayerTypes = Array.from(document.querySelectorAll('.filter-content input:checked'))
                    .map(checkbox => checkbox.value);

                // First, mark all rows with a custom attribute for filtering
                allRows.forEach(row => {
                    const playerTypeAttr = row.getAttribute('data-player-type');
                    const playerTypes = playerTypeAttr.split(' '); // Split the attribute into individual types
                    const shouldShow = selectedPlayerTypes.length === 0 || selectedPlayerTypes.some(type => playerTypes.includes(type));
                    row.setAttribute('data-filtered', shouldShow ? 'show' : 'hide');
                });

                // Count visible rows
                const visibleRows = allRows.filter(row => row.getAttribute('data-filtered') === 'show');

                // Show/hide rows based on filters
                allRows.forEach(row => {
                    row.style.display = row.getAttribute('data-filtered') === 'show' ? '' : 'none';
                });

                // Handle pagination elements
                const paginationControls = document.querySelector('.pagination-controls');
                const itemsPerPageContainer = document.querySelector('.items-per-page');

                if (selectedPlayerTypes.length > 0) {
                    // Hide pagination when filters are active
                    if (paginationControls) paginationControls.style.display = 'none';
                    if (itemsPerPageContainer) itemsPerPageContainer.style.display = 'none';
                } else {
                    // Show pagination when no filters are active
                    if (paginationControls) paginationControls.style.display = 'flex';
                    if (itemsPerPageContainer) itemsPerPageContainer.style.display = 'block';
                    
                    // Reinitialize pagination
                    const itemsPerPage = parseInt(document.getElementById('itemsPerPage').value);
                    const currentPage = 1; // Reset to first page
                    updatePaginationDisplay(visibleRows, currentPage, itemsPerPage);
                }

            }
 
            function updateRecordCount() {
                const table = document.getElementById('playersTable');
                const searchBox = document.getElementById('player_handle');
                const hasActiveSearch = searchBox && searchBox.value.trim().length > 0;
                const hasActiveFilters = document.querySelectorAll('.filter-content input:checked').length > 0;
                
                const allRows = Array.from(table.querySelectorAll('tr:not(:first-child)'))
                    .filter(row => {
                        // Exclude detail rows
                        if (row.classList.contains('details-row')) {
                            return false;
                        }
                        
                        // If there are active filters or search, check visibility
                        if (hasActiveSearch || hasActiveFilters) {
                            return row.getAttribute('data-filtered') !== 'hide' && 
                                   row.style.display !== 'none';
                        }
                        
                        // Otherwise, count all non-detail rows regardless of visibility
                        return true;
                    });
                
                const recordCountElement = document.getElementById('recordCount');
                if (recordCountElement) {
                    recordCountElement.textContent = allRows.length;
                }
            }


            function updatePaginationDisplay(visibleRows, currentPage, itemsPerPage) {

                // Calculate start and end indices for current page
                const startIndex = (currentPage - 1) * itemsPerPage;
                const endIndex = startIndex + itemsPerPage;

                // Show only rows for current page
                visibleRows.forEach((row, index) => {
                    row.style.display = (index >= startIndex && index < endIndex) ? '' : 'none';
                });

                // Update pagination controls
                updatePaginationControls(visibleRows.length, currentPage, itemsPerPage);
            }

            function updatePaginationControls(totalRows, currentPage, itemsPerPage) {
                const totalPages = Math.ceil(totalRows / itemsPerPage);
                const pageNumbers = document.getElementById('pageNumbers');
                const prevButton = document.getElementById('prevPage');
                const nextButton = document.getElementById('nextPage');
                
                // Clear existing page numbers
                pageNumbers.innerHTML = '';
                
                // Determine range of page numbers to show
                let startPage = Math.max(1, currentPage - 2);
                let endPage = Math.min(totalPages, startPage + 4);
                
                // Adjust start if we're near the end
                if (endPage - startPage < 4) {
                    startPage = Math.max(1, endPage - 4);
                }
                
                // Add first page if not in range
                if (startPage > 1) {
                    const pageButton = document.createElement('button');
                    pageButton.textContent = '1';
                    pageButton.className = 'page-number';
                    pageButton.addEventListener('click', () => {
                        window.currentPage = 1;
                        updatePaginationDisplay(Array.from(document.querySelectorAll('tr:not(:first-child)')).filter(row => !row.classList.contains('details-row')), 1, itemsPerPage);
                    });
                    pageNumbers.appendChild(pageButton);
                    
                    if (startPage > 2) {
                        const ellipsis = document.createElement('span');
                        ellipsis.textContent = '...';
                        ellipsis.className = 'ellipsis';
                        pageNumbers.appendChild(ellipsis);
                    }
                }
                
                // Add page numbers
                for (let i = startPage; i <= endPage; i++) {
                    const pageButton = document.createElement('button');
                    pageButton.textContent = i;
                    pageButton.className = 'page-number';
                    if (i === currentPage) {
                        pageButton.classList.add('active');
                    }
                    pageButton.addEventListener('click', () => {
                        window.currentPage = i;
                        updatePaginationDisplay(Array.from(document.querySelectorAll('tr:not(:first-child)')).filter(row => !row.classList.contains('details-row')), i, itemsPerPage);
                    });
                    pageNumbers.appendChild(pageButton);
                }
                
                // Add last page if not in range
                if (endPage < totalPages) {
                    if (endPage < totalPages - 1) {
                        const ellipsis = document.createElement('span');
                        ellipsis.textContent = '...';
                        ellipsis.className = 'ellipsis';
                        pageNumbers.appendChild(ellipsis);
                    }
                    
                    const pageButton = document.createElement('button');
                    pageButton.textContent = totalPages;
                    pageButton.className = 'page-number';
                    pageButton.addEventListener('click', () => {
                        window.currentPage = totalPages;
                        updatePaginationDisplay(Array.from(document.querySelectorAll('tr:not(:first-child)')).filter(row => !row.classList.contains('details-row')), totalPages, itemsPerPage);
                    });
                    pageNumbers.appendChild(pageButton);
                }
                
                // Update prev/next buttons
                prevButton.disabled = currentPage === 1;
                nextButton.disabled = currentPage === totalPages;
            }

            // Close dropdowns when clicking outside
            document.addEventListener('click', function(event) {
                if (!event.target.closest('.filter-dropdown')) {
                    document.querySelectorAll('.filter-content').forEach(content => {
                        content.style.display = 'none';
                    });
                }
            });

            console.log('Script loaded');


        </script>
        <script src="/js/pagination.js?v=1.0.0"></script>
        <script src="/js/config.js?v=1.0.0"></script>
        <script src="/js/timeUtils.js?v=1.0.0"></script>
        <script src="/js/toolTip.js?v=1.0.0"></script>
        </body>
        </html>
        