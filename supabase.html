<!DOCTYPE html>
<html>
<head>
    <title>Supabase Data Display</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <form onsubmit="event.preventDefault(); fetchData(document.getElementById('heroInput').value)">
        <input type="text" id="heroInput" placeholder="Enter hero handle">
        <button type="submit">Search</button>
    </form>
    <table id="data-table">
        <thead>
            <tr id="header-row"></tr>
        </thead>
        <tbody id="data-body"></tbody>
    </table>

    <script>
        async function fetchData(heroHandle = '') {
            try {
                const response = await fetch(`/api/trades?heroHandle=${encodeURIComponent(heroHandle)}`)
                const data = await response.json()
                
                if (!response.ok) {
                    throw new Error(data.error)
                }
                
                if (!data || data.length === 0) {
                    console.log('No data found for hero handle:', heroHandle)
                    document.getElementById('data-body').innerHTML = '<tr><td colspan="9">No data found</td></tr>'
                    return
                }
                
                // Create table headers
                const headerRow = document.getElementById('header-row');
                const headers = Object.keys(data[0]);
                headerRow.innerHTML = headers.map(h => `<th>${h}</th>`).join('');

                // Create table rows
                const tableBody = document.getElementById('data-body');
                tableBody.innerHTML = data.map(row => `
                    <tr>
                        ${headers.map(h => `<td>${row[h]}</td>`).join('')}
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error details:', error)
                document.getElementById('data-body').innerHTML = `<tr><td colspan="9">Error: ${error.message}</td></tr>`
            }
        }
        
        fetchData()
    </script>
</body>
</html>