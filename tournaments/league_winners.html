<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-LXJ5Q7LKKE"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){{dataLayer.push(arguments);}}
        gtag('js', new Date());
        gtag('config', 'G-LXJ5Q7LKKE');

        function formatTimestamp(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleString('en-US', {
                month: 'short',
                day: 'numeric',
                year: 'numeric',
                hour: 'numeric',
                minute: '2-digit',
                hour12: true
            });
        }

        async function fetchLeagueWinners() {
            try {
                const response = await fetch(`/data/tournaments/league_winners.json?_=${Date.now()}`);
                const data = await response.json();
                
                // Update timestamp
                const timestampElement = document.getElementById('timestamp');
                if (data.metadata?.data_freshness && timestampElement) {
                    timestampElement.textContent = formatTimestamp(data.metadata.data_freshness);
                }

                const latestTournament = Object.values(data.tournaments)[0];
                const leagueTypes = ['Elite', 'Gold', 'Silver', 'Bronze', 'Reverse'];
                
                leagueTypes.forEach(leagueType => {
                    const leagueData = latestTournament.leagues[leagueType];
                    if (!leagueData) return;

                    // Get the specific league section first
                    const leagueSection = document.querySelector(`.league-section:has(h2 img[src*="${leagueType.toLowerCase()}"])`);
                    
                    // Then find tables within this section
                    const top50Table = leagueSection.querySelector('.table-wrapper:first-child table tbody');
                    const itmTable = leagueSection.querySelector('.table-wrapper:last-child table tbody');

                    // Common table row generator function
                    const createTableRow = (hero) => `
                        <tr>
                            <td style="display: flex; align-items: center; gap: 10px;">
                                <img src="${hero.image_url}" alt="${hero.hero}" class="hero-image" width="70" height="90">
                                <div style="display: flex; flex-direction: column;">
                                    <span>${hero.hero}</span>
                                    <span class="star-rating">${hero.hero_stars}â˜…</span>
                                </div>
                            </td>
                            <td>${Math.round(hero.fantasy_score).toLocaleString()}</td>
                            <td>${Math.round(hero.usage_percentage)}% <span class="hero-count">(${hero.hero_count})</span></td>
                        </tr>
                    `;

                    // Update tables
                    if (top50Table && leagueData.top50) {
                        top50Table.innerHTML = leagueData.top50.slice(0, 10).map((hero, index) => createTableRow(hero, index)).join('');
                    }
                    
                    if (itmTable && leagueData.itm) {
                        itmTable.innerHTML = leagueData.itm.slice(0, 10).map((hero, index) => createTableRow(hero, index)).join('');
                    }
                });
            } catch (error) {
                console.error('Error fetching league winners:', error);
            }
        }

        document.addEventListener('DOMContentLoaded', fetchLeagueWinners);
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tournament League Winners</title>
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"></noscript>
    <link rel="stylesheet" href="../styles.css">
    <link rel="icon" type="image/png" href="../icons/favicon.webp">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="/js/timeUtils.js?v=1.0.0" defer></script>
</head>

<body>
    <div class="title-container">
        <h1 class="title-header">
            <a href="../index.html" class="home-link">
                <i class="fas fa-home"></i>
            </a>
            League Winners
            <span class="tournament-badge">Main 33</span>
        </h1>
    </div>
    <div class="small-text">
        <span id="timestamp"></span>
    </div>
    <div class="all-leagues-container">
        <!-- Elite League -->
        <div class="league-section">
            <h2><img src="../icons/elite.webp" class="league-icon" alt="Elite League"> Elite League</h2>
            <div class="tables-container">
                <div class="table-wrapper">
                    <h3>Top 50 Heroes</h3>
                    <table class="league-table elite-table">
                        <thead>
                            <tr>
                                <th>Hero</th>
                                <th>Score</th>
                                <th>Usage %</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Data populated dynamically -->
                        </tbody>
                    </table>
                </div>
                <div class="table-wrapper">
                    <h3>In The Money</h3>
                    <table class="league-table elite-table">
                        <thead>
                            <tr>
                                <th>Hero</th>
                                <th>Score</th>
                                <th>Usage %</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Data populated dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Gold League -->
        <div class="league-section">
            <h2><img src="../icons/gold.webp" class="league-icon" alt="Gold League"> Gold League</h2>
            <div class="tables-container">
                <div class="table-wrapper">
                    <h3>Top 50 Heroes</h3>
                    <table class="league-table gold-table">
                        <thead>
                            <tr>
                                <th>Hero</th>
                                <th>Score</th>
                                <th>Usage %</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Data populated dynamically -->
                        </tbody>
                    </table>
                </div>
                <div class="table-wrapper">
                    <h3>In The Money</h3>
                    <table class="league-table gold-table">
                        <thead>
                            <tr>
                                <th>Hero</th>
                                <th>Score</th>
                                <th>Usage %</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Data populated dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Silver League -->
        <div class="league-section">
            <h2><img src="../icons/silver.webp" class="league-icon" alt="Silver League"> Silver League</h2>
            <div class="tables-container">
                <div class="table-wrapper">
                    <h3>Top 50 Heroes</h3>
                    <table class="league-table silver-table">
                        <thead>
                            <tr>
                                <th>Hero</th>
                                <th>Score</th>
                                <th>Usage %</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Data populated dynamically -->
                        </tbody>
                    </table>
                </div>
                <div class="table-wrapper">
                    <h3>In The Money</h3>
                    <table class="league-table silver-table">
                        <thead>
                            <tr>
                                <th>Hero</th>
                                <th>Score</th>
                                <th>Usage %</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Data populated dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Bronze League -->
        <div class="league-section">
            <h2><img src="../icons/bronze.webp" class="league-icon" alt="Bronze League"> Bronze League</h2>
            <div class="tables-container">
                <div class="table-wrapper">
                    <h3>Top 50 Heroes</h3>
                    <table class="league-table bronze-table">
                        <thead>
                            <tr>
                                <th>Hero</th>
                                <th>Score</th>
                                <th>Usage %</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Data populated dynamically -->
                        </tbody>
                    </table>
                </div>
                <div class="table-wrapper">
                    <h3>In The Money</h3>
                    <table class="league-table bronze-table">
                        <thead>
                            <tr>
                                <th>Hero</th>
                                <th>Score</th>
                                <th>Usage %</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Data populated dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Reverse League -->
        <div class="league-section">
            <h2><img src="../icons/reverse.webp" class="league-icon" alt="Reverse League"> Reverse League</h2>
            <div class="tables-container">
                <div class="table-wrapper">
                    <h3>Top 50 Heroes</h3>
                    <table class="league-table reverse-table">
                        <thead>
                            <tr>
                                <th>Hero</th>
                                <th>Score</th>
                                <th>Usage %</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Data populated dynamically -->
                        </tbody>
                    </table>
                </div>
                <div class="table-wrapper">
                    <h3>In The Money</h3>
                    <table class="league-table reverse-table">
                        <thead>
                            <tr>
                                <th>Hero</th>
                                <th>Score</th>
                                <th>Usage %</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Data populated dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</body>

<style>
     /* Add specific colors for each league table */
    .elite-table th { background-color: #a8ccde; color: white; }
    .gold-table th { background-color: #dacc86; color: white; }
    .silver-table th { background-color: #8b8b8b; color: white; }
    .bronze-table th { background-color: #a97e48; color: white; }
    .reverse-table th { background-color: #82EA89; color: white; }

    .hero-image {
        border-radius: 0;
        object-fit: cover;
        flex-shrink: 0;
    }

    .hero-count {
        font-size: 0.8em;
        color: #666;
        margin-left: 4px;
    }

    /* Add these new styles */
    .all-leagues-container {
        display: flex;
        gap: 20px;
        overflow-x: auto;
        padding: 20px;
    }

    .league-section {
        flex: 0 0 auto;
        min-width: 300px;
    }

    .tables-container {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    /* Adjust table sizes for horizontal layout */
    .table-wrapper {
        width: 100%;
    }

    .league-table {
        width: 100%;
    }

    /* Ensure table cells can handle flex content */
    .league-table td {
        vertical-align: middle;
    }

    .star-rating {
        font-size: 12px;
        font-weight: 600;
        color: #1a1a1a;
        background: linear-gradient(45deg, #ffd700, #ffa500);
        padding: 2px 8px;
        border-radius: 12px;
        display: inline-block;
        margin-top: 4px;
        box-shadow: 0 1px 2px rgba(0,0,0,0.1);
    }
</style>

    